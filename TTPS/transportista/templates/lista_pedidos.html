{% extends 'base_maps.html' %}
{% load static %}
{% load filters %}
{% block content %}
    {% if hoja_de_ruta %}

    <div class="container-transportista">
        <!-- Fecha -->
        <div class="info">
            <span id="current-date">Fecha: {{ hoja_de_ruta.fecha }}</span>
        </div>

        <!-- Botón de iniciar recorrido -->
        <button class="btn-transportista" id="start-btn" onclick="startRecorrido()">Iniciar recorrido</button>

        <!-- Mensaje dinámico -->
        <div class="message" id="status-message">
          {% if hoja_de_ruta.estado == 'generada' %}
            {% if not hoja_de_ruta.pedidos %}
                No hay pedidos para el día de hoy.
            {% else %}
                Tus pedidos del día de hoy
            {% endif %}
          {% elif hoja_de_ruta.estado == 'en_curso' %}
              {% with hoja_de_ruta.pedidos.all|filtrar_pendientes:"pendiente" as pedidos_pendientes %}
                <p>Pedidos pendientes: {{ pedidos_pendientes.count }}</p>
              {% endwith %}
          {% elif hoja_de_ruta.estado == 'finalizada' %}
            Has completado tu recorrido.
          {% endif %}         
        </div>

        <!-- Lista de pedidos -->
        <div class="pedido-list" id="pedido-list">
            {% for pedido in hoja_de_ruta.pedidos.all %}
                <div class="pedido-item">
                    <div>
                        <p><strong>Centro:</strong> {{ pedido.centro.nombre }}</p>
                        <p><strong>Dirección:</strong> {{ pedido.centro.direccion }}</p>
                    </div>
                    <button onclick="verPedido('{{ pedido.id_pedido }}')">Ver</button>
                </div>
            {% endfor %}
        </div>

        <a class="btn-transportista" href="{% url 'transportista:ver_mapa' hoja_de_ruta.id_hoja_de_ruta %}">Ver mapa</button>
    </div>
    {% else %}
        <h3>No hay hoja de ruta para el día de hoy.</h3>
    {% endif %}
{% endblock %}